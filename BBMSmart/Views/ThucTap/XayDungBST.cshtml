@using ProductAllTool.Models.ManageSales;
@using ProductAllTool.Common
@using System.Data
@{
    ViewBag.Title = "Xây dựng BST";
    Layout = "~/Views/Shared/_Layout_V2.cshtml";
}


<div class="AutoFix">
    <div class="row" id="form_search">
        <div class="col-md-12">
            <div class="col-md-6">
                <div class="col-md-12">
                    <div class="col-md-6">
                        <div class="col-md-12">
                            <div>
                                <button type="button" class="btn btn-primary" onclick="js_BST_ADD();">Tạo Mới</button>
                            </div>
                            <div>
                                <button type="button" class="btn btn-primary" onclick="">Lưu </button>
                            </div>
                            <br />
                            <br />
                            <div class="col-md-12">
                                <label>Mã BST &nbsp;</label> <span id="MaBST" class="txtma"></span>
                                <input id="MaBST" type="text" class="form-control" value="" disabled />
                                @ViewBag.listautocode[0]
                            </div>


                            <div class="col-md-12">
                                <label>Tên BST  &nbsp;</label> <span id="TenBST" class="txtten"></span>
                                <input id="tenBST" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>Category &nbsp;</label> <span id="Category" class="txtcate"></span>
                                <input id="category" type="text" class="form-control" />
                            </div>

                            <div class="col-md-12">
                                <label>Mùa vụ  &nbsp;</label> <span id="MuaVu" class="txtmuavu"></span>
                                <input id="muaVu" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>Đối Tượng &nbsp;</label> <span id="DoiTuong" class="txtdoituong"></span>
                                <input id="doiTuong" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>Giới Tính &nbsp;</label> <span id="GioiYinh" class="txtgioitinh"></span>
                                <input id="gioiTinh" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>Thu Nhập &nbsp;</label> <span id="ThuNhap" class="txtthunhap"></span>
                                <input id="thuNhap" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>USP &nbsp;</label> <span id="USP" class="txtusp"></span>
                                <input id="usp" type="text" class="form-control" />
                            </div>


                            <div class="col-md-12">
                                <label>Thông Điệp &nbsp;</label> <span id="ThongDiep" class="txtthongdiep"></span>
                                <input id="thongDiep" type="text" class="form-control" />
                            </div>

                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="col-md-12">
                            <label class="text text-primary" ondblclick="$('#MaBST').val().trigger('Change')">Mã BST:</label>
                            <input id="MaBST" type="text" onchange="js_XayBST();" />
                        </div>
                        <div class="col-md-12">
                            <label class="text text-primary" ondblclick="$('#MaBST').val().trigger('Change')">Tên BST:</label>
                            <input id="TenBST" type="text" onchange="js_XayBST();" />
                        </div>
                        <br />
                        <div class="col-md-12 col-xs-12 half_col ">
                            <div class="Upload_img" style="width:100%;height:100%">
                                <input class="form-control" type="hidden" id="imgLink">
                                <div id="wp_thum_img" onclick="reupimg()" style="text-align:center;">
                                    <div class="img_src" style="width:100%;height: 100%;">
                                        <img id="thum_img" for="fileUpload" src="" />
                                        <div id="upload_theme" style="margin-top:-19px;width:100%;height:100%">
                                            <img src="~/Image/add.svg" style="width:20%;margin-top:60px;margin-bottom:10px" />
                                            <p style="">Upload Img</p>
                                        </div>
                                    </div>
                                </div>
                                <form id="upload" enctype="multipart/form-data" action="@Url.Action("uploadImg", "Goods")" method="POST" style="display:none">
                                    <input type="file" style="width: 0.1px;height: 0.1px;opacity: 0;overflow: hidden;position: absolute;z-index: -1;" name="fileUpload" id="fileUpload" class="inputfile">
                                    <label class="btn btn-success" for="fileUpload" style="width:100%;margin: 10px 0px;font-size:12px"><i class="fa fa-upload" aria-hidden="true"></i>upload</label>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
         
            <div class="col-md-6">
                <div class="col-12 stretch-card pl-0 pr-0" style="height:320px; overflow-y:auto">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="table-responsive" id="div-content">
                                @Html.Partial("~/Views/ThucTap/Partial/_XayDungBST.cshtml")
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.js"></script>
<link href="https://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.css" rel="stylesheet" />


<script type="text/javascript">


    $(function () {
        $('#txtHead').html("XÂY DỰNG BỘ SƯU TẬP/COMBO");
        js_XayBST();
    });
    function js_ReloadTable() {
        $('#tbl_Item')
            .DataTable({
                lengthMenu: [[20, 50, 70, 100, -1], [20, 50, 70, 100, ]],
                "pageLength": 8,
                fixedHeader: {
                    headerOffset: 147
                },
                columnDefs: [
                ],
                "orderClasses": false,
                "deferRender": true,

                autoWidth: false,
                bAutoWidth: false,
                "searching": false,
                reponsive: false,
                order: []
            });
    }
    function js_XayBST() {
      
        var MaBST = $('#MaBST').val();
        var TenBST = $('#TenBST').val();

        $.ajax({
            url: '/ThucTap/XayBST',
            type: 'POST',
            data: JSON.stringify({ MaBST: MaBST, TenBST: TenBST }),
            contentType: 'application/json, charset=utf-8',
            beforeSend: function () {
                js_Loading(true, 1);
            },
            success: function (data) {
                $('#div-content').html(data);
                js_ReloadTable();
                js_Loading(false, 1);
            },
            error: function () {
                js_Loading(false, 1);
            }
        });
    }

    $("#fileUpload").change(function () {
        var vtrUpload = $("#fileUpload").val().toLowerCase();
        var regexVTRUpload = new RegExp("(.*?)\.(png|jpg|jpeg)$");
        if (!(regexVTRUpload.test(vtrUpload))) {
            $("#fileUpload").val("");
            jAlert('file false.', 'Thông báo');
        } else {
            UploadFile();
        }
    });

    function UploadFile() {

        js_Loading(true, 1);

        var data = new FormData();   
        var files = $("#fileUpload").get(0).files;
        if (files.length > 0) {
            data.append("MyImages", files[0]);
        }
        data.append("foldername", 'Goods');
        $.ajax({
            url: "/ThucTap/uploadImg",
            type: "POST",
            processData: false,
            contentType: false,
            data: data,
            async: true,
            success: function (data) {
                js_Loading(false, 1);
                if (data.code == 1) {
                    img_link = data.link;
                    $('#imgLink').val(data.link);
                    $('#upload_theme').hide();
                    $('#thum_img').show();
                    $('#thum_img').css({ "width": "auto", "height": "auto", "max-width": "100%", "max-height": "100%", "object-fit": "contain" });
                    $('#thum_img').attr("src", data.link);
                }
                else {
                    $('#upload_theme').css({ "display": "block" });
                    jAlert(data.link);

                }
            },
            error: function (er) {
                alert("Thiết bị không hỗ trợ up ảnh từ camera. Chọn file từ bộ nhớ thiết bị!");
            }
        });
    }

    function reupimg() {
        $("#fileUpload").click();
    }

    function js_BST_ADD() {

        var MaBST = $('#MaBST').val();
        var TenBST = $('#TenBST').val();
        var Category = $('#Category').val();
        var MuaVu = $('#MuaVu').val();
        var DoiTuong = $('#DoiTuong').val();
        var GioiYinh = $('#GioiYinh').val();
        var ThuNhap = $('#ThuNhap').val();
        var USP = $('#USP').val();
        var ThongDiep = $('#ThongDiep').val();

        $.ajax({
            url: '/ThucTap/BST_ADD',
            type: 'POST',
            data: JSON.stringify({ MaBST: MaBST, TenBST: TenBST }),
            contentType: 'application/json, charset=utf-8',
            beforeSend: function () {
                js_Loading(true, 1);
            },
            success: function (data) {
                $('#div-content').html(data);
                js_ReloadTable();
                js_Loading(false, 1);
            },
            error: function () {
                js_Loading(false, 1);
            }
        });
    }

    
</script>




